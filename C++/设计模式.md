# 设计模式——可复用面向对象软件的技术

## 概述

定义：每一个模式**描述**了一个在我们周围不断重复发生的问题，以及该问题的**解决方案的核心**。这样，你就能一次又一次的使用该方案而不必做重复劳动。 —— Chirstopher Alexander

重点：偏重于对抽象思维的理解

1. 向下：深入理解三大面向对象机制
   - 封装：隐藏内部细节
   - 继承：复用代码行为
   - 多态：改变对象行为
2. 向上：深刻把握面向对象机制所带来的**抽象意义**，理解如何使用这写机制来表示显示世界，掌握什么是“好的面向对象设计”。取决于抽象思维

软件设计复杂的**根本原因**：**变化**

- 客户需求的变化
- 技术平台的变化
- 开发团队的变化
- 市场环境的变化
- 。。。

**解决**复杂性：

1. **分解**
   - 大问题分为小问题，分而治之
2. **抽象**
   - 一个通用的技术——由于无法掌握全部复杂对象，选择忽略非本质问题，而去处理泛化的理想化了的对象模型
   - 化为一种同一的方法，统一处理
3. 合理的使用分解和抽象，会使代码的重用性得到提高，也就是更好的代码

软件设计的**目标**：**复用**

**模式分类**

从目的来看

- 创建型模式
- 结构型模式
- 行为型模式

从范围来看

- 类模式 处理 类与子类的静态关系 （继承方案）
- 对象模式 处理 对象间的动态关系 （组合方案）

---

## 面向对象设计原则

**优势：抵制变化**

重新认识面向对象

1. 隔离变化
   - 宏观层面，面向对象的构建方式更适合软件的设计变化，能将变化带来的影响减为最小
   - 下面的原则也都需要满足隔离变化，将变化和稳定相互分离，便于设计
2. 各司其职
   - 微观层面，面向对象强调各个类的”责任“（类的功能作用目的）
   - 由于需求变化导致新增类型，不应该影响原来类型的实现
3. 对象本质
   - 语言层面，对象封装了代码和数据（变量和方式）
   - 规格层面，对象是一系列可被使用的公共接口
   - 概念层面，对象是某种**拥有责任的抽象**

面向对象设计**原则** —— 面向接口设计

1. DIP 依赖倒置原则
   - 高层模块（稳定）不依赖于低层模块（变化），二者都依赖于抽象（稳定）
   - 抽象（稳定）不应该依赖于实现细节（变化），实现细节应该依赖于抽象（稳定）
   - （可以提出抽象类，让高层低层依赖于抽象类，细节也依赖于抽象类，但抽象类不能依赖细节）（抽象本身就是要忽略非本质的内容——细节）
2. OCP 开放封闭原则
   - 对扩展开放，对更改封闭
   - 类模块应该是可扩展的，但是不可修改的
   - （相比于修改，更应该进行扩展，而不是大幅度的重新构造修改）
   - （用扩展来满足变化）
3. SRP 单一责任原则
   - 一个类应该仅有一个引起变化的原因
   - 变化的方向隐含着类的责任
4. LSP Liskov替换原则
   - 子类必须能够替换他们的基类(IS-A)
   - 继承表达类型抽象
5. ISP 接口隔离原则
   - 不应该强迫客户程序依赖它们不用的方法 （乱public发生变化时，会产生大量的修改）
   - 接口应该小而完备 （不要把不必要的方法public出来）
6. 优先使用对象组合，而不是类继承
   - 类继承通常为“白箱复用”，对象组合通常为“黑箱复用”
   - 继承在某种程度上破坏了封装性（需要public出来的东西比较多），子类父类耦合度高。
   - 而对象组合则只需要被组合的对象具有良好定义的接口，耦合度低
   - （继承关系更像是一种类属于包含关系，人继承于动物，汽车继承于交通工具）
7. 封装变化点
   - 使用封装来创建对象之间的分界点，让设计者可以在分界的一侧进行修改，而不会对令一侧产生不良的影响，从而实现层次间的松耦合
8. 针对接口编程，而不是针对实现编程
   - 不将变量类型声明为某个特定的具体类，而是声明为某个接口。
   - 客户程序无需获知对象的具体类型，只需要知道对象所具备的接口。
   - 减少系统中各部分的依赖关系，从而实现“高内聚、松耦合” 的类型设计方案

---

## 类与类的关系

1. 继承
   - **表示**：在 UML 图中，用一个空三角箭头表示。
2. 关联
   - 关联表示两个类之间的一般关系，一个类对象可以引用或使用另一个类对象
   - **方向性**：可以是单向（如 A → B）或双向（A ↔ B）。
   - **表示**：在 UML 图中，用一个实三角箭头表示。
3. 聚合
   - 聚合是一种弱的“整体与部分”的关系，部分可以独立于整体存在。
   - **关系强度**：松散的整体-部分关系。
   - **生命周期**：整体和部分的生命周期**不依赖**，部分可以存在于多个整体中，也可以独立存在。
   - **表示**：在 UML 图中，用一个空心的菱形箭头表示。
4. 组合
   - 组合是一种强的“整体与部分”的关系，部分依赖于整体的存在。
   - **关系强度**：紧密的整体-部分关系。
   - **生命周期**：部分的生命周期**依赖于整体**，整体销毁时，部分也会被销毁。
   - **表示**：在 UML 图中，用一个实心的菱形箭头表示。
5. 依赖
   - 依赖是一种“**暂时使用**”的关系，表示一个类在实现某功能时需要另一个类的协助
   - **表示**：在 UML 图中，用一个虚线箭头表示。

---

## 创建型

### 工厂模式

将new替换为用工厂来创建对象，提高了可移植性和扩展性

编写小项目可能不是很明显

### 抽象工厂

将多个产品封装到一个子工厂中，扩展了工厂的功能



---

## 结构型

### 装饰模式

- 也叫封装器

- 利用组合或聚合，扩展新功能

- 拓展一个新功能可以在子类中添加，而这样做会生成极多的子类，因此可以使用装饰模式，将原内容使用装饰类修饰
- 继承的扩展功能等于是重构重写，而使用组合则是添加功能
- 继承的重要好处是，多态的使用方法













